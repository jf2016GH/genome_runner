<!DOCTYPE html>
<html lang="en">
<head>
	<link href="static/css/bootstrap.min.css" rel="stylesheet">
	<style>
	body {
		padding-top: 60px; /* 60px to make the container go all the way to the bottom of the topbar */
	}
	/* allows the check box tree to be rendered correctly*/
	.ui-icon {float: left;}
	.popover {background: whiteSmoke;border: 1px solid #5E5E5E;}
	</style>

	<!-- For IE6-8 support of HTML5 elements -->
	<!--[if lt IE 9]>
	<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" href="static/css/ui-lightness/jquery-ui-1.8.16.custom.css " rel="stylesheet" />
	<link type="text/css" href="static/css/main.css"/>
	<link type="text/css" href="static/css/demo_table.css"/>
	<script type="text/javascript" src="static/js/jquery.js"></script>
	<script type="text/javascript" src="static/js/jquery-ui-1.8.22.custom.min.js"></script>
	<script type="text/javascript" src="static/js/jquery.ui.widget.js"></script>
	<script type="text/javascript" src="static/js/jquery.checkboxtree.js"></script>
	<script src="static/js/fcbkcomplete.min.js" type="text/javascript" charset="utf-8"></script>
	<script src="static/js/jquery.slimScroll.js" type="text/javascript" charset="utf-8"/>
	<!-- File input -->
	<script src="static/js/enhance.min.js"i type="text/javascript"></script>
	<script src="static/js/jquery.fileinput.js" type="text/javascript"></script>
	<link type="text/css" href="static/css/jqury.ui.fileinput.css"></link>

	<link rel="stylesheet" href="static/css/combobox.css" type="text/css" media="screen" title="Test Stylesheet" charset="utf-8" />
	<script src="static/js/bootstrap.min.js"></script>
	<script scr="static/js/main.js"></script>

	<script type="text/javascript">
	function getQueryVariable(variable) { 
		var query = window.location.search.substring(1); 
		var vars = query.split("&"); 
		for (var i = 0; i < vars.length; i++) { 
			var pair = vars[i].split("="); 
			if (pair[0] == variable) { 
				return pair[1]; 
			} 
		} 
		return null; 
	} 

	$(document).ready(function() {
		$('#ucsc').checkboxTree({
			initializeChecked: 'collapsed',
			initializeUnchecked: 'collapsed',
			collapseEffect: '',
			expandEffect: ''
		});

		$('#org').change(function() {;
			var org = document.getElementById("org").value;
			var temp = org.split(":");
			var $url="index?organism=" + temp[1];
			window.location = $url;})

		if (getQueryVariable('organism') != null){
			$('#org').val("organism:" + getQueryVariable('organism'));}

			else{$('#org').val("organism:hg19");}
			$.facebooklist('#gfs', '#preadded', '#grfs-auto',{url:'static/gfs.php',cache:1}, 10, {userfilter:1,casesensetive:1});

			$('input:submit').button();
			$(function() {
				$("#accordion").accordion({
					collapsible: true,
					active: false
				});
			});

			// The tooltips
			$("#helpbackground").popover({content: "If no background file is uploaded, then the genome is used as a background.", placement: "top"});
			$("#helpfeature").popover({content: "<p style='text-align: center'>Upload a bed formated file containing regions of interest,SNPs or both <br/> to run the enrichment analysis on.</p>", placement: "top"});

			// the viewport for the treeview
			$("#treeview-inner").slimScroll({
			    	height: $("#ucsc").height(),
			    	width: '540px',
			    	alwaysVisible: true
			});

			
		});
		function viewBoxClick(){
			var minHeight = 300;
			var maxHeight = 500;			
			// resize to the expanded treeview as long as it is less than 500			
			if ($("#ucsc").height() <= maxHeight) {
				var oldHeight = $(".slimScrollDiv").height();
				//$(".slimScrollDiv").css("height", $('#ucsc').height()+'px');
				$(".slimScrollDiv").height($('#ucsc').height());
				$("#treeview-inner").height($("#treeview-inner").height() + $(".slimScrollDiv").height() - oldHeight);

			}
			else if ($("#ucsc").height() > maxHeight){
				//$(".slimScrollDiv").css("height",maxHeight + 'px');
				$(".slimScrollDiv").height(maxHeight);
				$("#treeview-inner").height(maxHeight);
			}

		}
		function switchinput(checked){
			if (checked == "bedfile"){
				document.getElementById("inputbedfile").disabled=false;
				document.getElementById("inputbeddata").disabled=true;
				document.getElementById("inputbeddata").text = ""
				document.getElementById("inputbeddata").value = ""
			}
			else {
				document.getElementById("inputbedfile").disabled=true;
				document.getElementById("inputbeddata").disabled=false;
				document.getElementById("inputbeddata").text = ""
				document.getElementById("inputbeddata").value = ""
			}
		}

		function switchbackgroundinput(checked){
			if (checked == "backgroundfile"){
				document.getElementById("inputbackgroundfile").disabled=false;
				document.getElementById("inputbackgrounddata").disabled=true;
				document.getElementById("inputbackgrounddata").text = ""
				document.getElementById("inputbackgrounddata").value = ""
			}
			else {
				document.getElementById("inputbackgroundfile").disabled=true;
				document.getElementById("inputbackgrounddata").disabled=false;
				document.getElementById("inputbackgrounddata").text = ""
				document.getElementById("inputbackgrounddata").value = ""
			}
		}

		//prevents user from submitting form by accidentally pressing the enter key
		function stopRKey(evt) { 
			var evt = (evt) ? evt : ((event) ? event : null); 
			var node = (evt.target) ? evt.target : ((evt.srcElement) ? evt.srcElement : null); 
			if ((evt.keyCode == 13) && (node.type=="text"))  {return false;} 
		} 

		function changeCheckedStateTreeView(checkAll){
			if (checkAll == true){
				$('#ucsc').checkboxTree('expandAll');
				viewBoxClick();
			}
			else {
				$('#ucsc').checkboxTree('collapseAll');
				viewBoxClick();
			}
		}

		document.onkeypress = stopRKey; 

</script>
</head>
<body bgcolor="#A8D5FF" style="width: 800px">

	<div class="topbar">
		<div class="topbar-inner">
			<div class="container-fluid">
				<a class="brand" href="./" style="font-family:Futura,'Helvetica Neue', Arial">
					<img width="200px" src="static/images/GRLogo.png" />
				</a>
				<ul class="pull-right">
					<li><a href="./overview">Overview</a></li>
					<li><a href="./news">News</a></li>
					<li><a href="./">Use GenomeRunner</a></li>
					<li><a href="./demo">Demo</a></li>
					<li><a href="./cite">How to Cite</a></li>
				</ul>
			</div>
		</div>
	</div>
	<form action="query" method="post" enctype="multipart/form-data">
		<div class="well">
			<b style="font-size:150%;">Organism</b>
			${paths.org_as_html(id="org")}
		</div>
		<div class="well">
			<h3>1. Upload Features of Interest <img id="helpfeature" style="position: relative;top: 6px;" 								width=25 height=25 src="static/images/help-icon.png" alt="help"/>
			</h3> 
			<ul>
				<li id="list-bedfeatures">
					<input type="radio" name="rdbed"  checked="checked"  value="bedfile" onclick="switchinput(this.value)"/>
					Bed File:<input type="file" id="inputbedfile" style="margin:5px" name="bed_file" />
				</li>
				<li id="list-listfeatures">
					<span style="margin-right:5px; float: left">
						<input name="rdbed" type="radio" id="bedchoicedata" style="margin:5px" value="beddata" onclick="switchinput(this.value)"/>
					</span>
					<span style="margin-right:5px; float: left">Paste Data in Bed Format:
					<img id="helpfeature" style="position: relative;top: 6px;" width=25 height=25 src="static/images/help-icon.png" alt="help"/>
				</span>
					<br/><br/>
					<textarea id="inputbeddata" rows=5 cols=50 style="margin:5px" name="bed_data" disabled>
					</textarea>
				</li>
			</ul>
		</div>
		<div class="well">
			<h3>2. Upload a Background (Optional)<img id="helpbackground" style="position: relative;top: 6px;"								width=25 height=25 src="static/images/help-icon.png" alt="help"/>
			</h3>
			<ul>
				<li id="list-bedbackground">
					<input type="radio" name="rdbackground"  checked="checked" style="margin:5px" value="backgroundfile" onclick="switchbackgroundinput(this.value)"/>
					Bed File:
					<input type="file" id="inputbackgroundfile" style="margin:5px" name="background_file" />
				</li>
				<li id="list-background">
					<span style="margin-right:5px; float: left">

						<input name="rdbackground" type="radio" id="bedchoicedata" style="margin:5px" value="backgrounddata" onclick="switchbackgroundinput(this.value)"/>	
					</span>
					<span style="margin-right:5px; float: left">
						Paste Data in Bed Format:
						<img id="helpfeature" style="position: relative;top: 6px;" width=25 height=25 src="static/images/help-icon.png" alt="help"/>
					</span>
						<br/><br/>
					<textarea id="inputbackgrounddata" rows=5 cols=50 style="margin:5px" name="background_data" disabled>
					</textarea>
				</li>
			</ul>
		</div>
		<div class="well">
			<h3>3. Choose tracks of interest:</h3>
			<div id="grfdroplist">
				<label >Enter track names: </label>
				<ol style="left: 24px;position: relative; padding-top:10px;padding-bottom:10px;">        
					<li id="grf-list" class="input-text">
						<input style="float: left;" type="text" value="" id="gfs" class"grf"/>
					</li>
					<div id="grfs-auto">
						<div class="default">Type the names of the GenomeRunner features to run</div> 
						<ul id="feed">
						</ul>
					</div>
				</ol>   
			</div>
			<label >Select track names: </label>
				<div>
					<a class="btn" onClick="changeCheckedStateTreeView(true)">Expand All</a>
					<a class="btn" onClick="changeCheckedStateTreeView(false)">Collapse All</a>
				</div>
			<div id="treeview-outer" style="padding-top:10px">
				<div id="treeview-inner" onClick="viewBoxClick()">
					${paths.as_html(id="ucsc")}
				</div>
			</div>
		</div>
		
		<div id="accordion" style="padding-bottom: 1em;list-style:none;">			
			<h3  id="accordionheader"><a href="#" style="font-size:120%">5.Select Tests (Advanced)</a></h3> 
			<div>
				<div class="well">
					<table class="table table-bordered table-striped">
						<tbody>
							<tr>
								<td>Calculates the P-Value using Monte Carlo and the PyBedTools intersect. Can use custom background</td>
								<td>
									<input type="checkbox" id="chk_pvalue"  name="run:pvalue" checked="checked"/><label for="chk_pvalue">Standard P-Value</label>
								</td>
							</tr>
							<tr>
								<td>Calculates the P-Value using PyBedTools. Ignores custom background</td>
								<td>
									<input type="checkbox" id="chk_pybedtool"  name="run:pybedtool" /><label for="chk_pybed">BedTools P-Value</label>
								</td>
							</tr>
							<tr>
								<td>Calculates the P-Value using the Jaccard statistical test. Ignores custom background</td>
								<td>
									<input type="checkbox" id="chk_jaccard" name="run:jaccard" /><label for="chk_jaccard">Jaccard P-Value</label>
								</td>
							</tr>
							<tr>
								<td>Runs a proximity analysis. TEST: currently uses background, are the results as expected? Also calculates a P-Value</td>
								<td>
									<input type="checkbox" id="chk_proximity"  name="run:proximity" /><label for="chk_proximity">Proximity</label>
								</td>
							</tr>
							<tr>
								<td>Calculates a P-Value using the Kolmogorov-Smornov statistical test. Ignores custom background</td>
								<td>
									<input type="checkbox" id="chk_kolmogorov"  name="run:kolmogorov" /><label for="chk_kolmogorov">Kolmogorov-Smornov P-Value</label>
								</td>
							</tr>
							<tr>
								<td>Calculates a p-value using hypergeometric distribution</td>
								<td>
									<input type="checkbox" id="chk_hypergeometric"  name="run:hypergeometric" /><label for="chk_hypergeometric">Hypergeometric Distribution P-Value</label>
								</td>
							</tr>
						</tbody>
					</table>
				</div>
				<div class="well">
					<b># MC iters:</b>
					<input id="niter"
					type="text" name="niter" value="10"/> <br />
					<b>Score cutoff:</b>
					<input type="text" name="score" /> <br />
					<b>Strand:</b>
					<input checked="yes" 
					type="radio" name="strand" value="" />Any
					<input type="radio" name="strand" value="+" />+
					<input type="radio" name="strand" value="-" />-
					<br />
				</div>
			</div>
		</div>
		<div class="well">
			<h3>6. Run query!</h3> 
			<ul>
				<li>
					<input id="jobname" name="jobname" type="text" value=""/>
					<label style="float:left; margin: 5px;">Enter a job name (optional):</label>
				</li>
				<li>
					<input class="btn btn-primary" type="submit" / >
				</li>
			</ul>
			<br>
			<div class="ui-state-highlight ui-corner-all">
				<p><span class="ui-icon ui-icon-info" style="float: left; margin-right: .3em;">
				</span>GenomeRunner works best in Chrome or Internet Explorer 9+</p>
			</div>

		</div>
	</form>
</body>
</html>
