************
GRSNP Readme
************

To install grsnp run the following command within the repository:

.. code-block:: bash

    python setup.py develop install --user

There are three important modules in this package:

1) grsnp.server
2) grsnp.dbcreator
3) grsnp.optimizer

Note that throughout this guide [dir] represents the location that the GRSNP database was installed (i.e [dir] = ~/Documents/gr_data)

Installing the database
=======================

The GRSNP database can be generated with the following command:

.. code-block:: bash

    python -m grsnp.dbcreator -g hg19 -d ~/Documents/gr_data

The -d parameter designates where the database is to be installed. This exact path should be passed to grsnp.server.
The DBcreator performs several steps:

* Downloads required files from USCS and place in [dir]/downloads/
* Converts files into standard bed format and zip with bgzip.  Unsupported data formats are skipped.
* Places converted files are placed in [dir]/grsnp_db/[organism]/[group]/[tier]/

FAQ
---

* How do I install multiple organism?
  
   * Simply re-run the DBcreator and designate a different organism with the -g parameter.

* Can I run the DBcreator on an existing database?
  
   * Yes, the DBcreator detects which GFs have already been installed.
   
* The DBcreator is taking a long time to run.  Can I 'kill' it?
  
   * Yes, the DBcreator flags partially completed GFs with a '.tmp' extension.  These GFs are not visible to the server.

* Can I download individual GFs?
  
   * Individual GFs can be installed by giving the name to the -f parameter (i.e '-f knownGene' ).

* Is Rsync supported?
  
   * Rsync can be used to mirror the USCS data files .. code-block:: bash
   
       INSERT CODE
   * Before downloading any files, the DBcreator checks the [dir]/downloads/ directory for the required files.
   

Pre-calculating GFs and default backgrounds overlap statistics
=====================================================
     
     To greatly shorten the enrichment analysis time, grsnp.optimizer should be run on the database.
     The number of background SNPs that overlap the GFs (called 'bgs_obs') are obtained once by grsnp.optimizer and stored in a file located at [dir]/grsnp_db/[organism]/bkg_overlaps.gr.
     Before running the optimizer, be sure to place some default backgrounds in [dir]/gr_data/custom_data/backgrounds/[organism]/
     Continuing from our example above, we can run the following command:

     .. code-block:: bash
     
          python -m grsnp.optimizer -g hg19 -d ~/Documents/gr_data


FAQ
---

* Does the optimizer do all of the organism at once?
  
   * No, the optimizer must be run for each organism
     
* I started the optimizer on an database that already contains the [dir]/grsnp_db/[organism]/bkg_overlaps.gr file.  Can I terminate?
 
   * Yes, you can safely terminate the process.  The file is not modified till the very end of the optimization process.
    
* How is the bkg_overlaps.gr file structured?
  
   [Absolute path to GF file]\t[Absolute path to default background_one]:[bgs_obs]:[n_bgs],[Absolute path to default background_two]:[bgs_obs]:[n_bgs]


Starting the server
===================


A local GRSNP server can be started with the following command.  The -d parameter must point to the directory containing the database created by the dbcreator:

.. code-block:: bash

    python -m grsnp.server -p 8000 -d ~/Documents/gr_data

The server can be access via the following address: 
.. code-block::

    localhost:8081/gr/

The grsnp.server creates several directories in the [/dir] if they do not yet exist.

* [dir]/run_files 
	
   * Stores files that are uploaded to the server by the user and also stores the results of the analysis

The following directories are generated by the sever. Bed files or .gz files should be added to the appropriate directories:

* [dir]/custom_data/gfs/[organism id]
 
   * Stores default genomic features. Sets of default genomic features should be placed in separate folders in this directory.
	
* [dir]/custom_data/fois/[organism id]

   * Stores default feature of interests. Sets of default features of interest files should be placed in separate folders in this directory.

* [dir]/custom_data/backgrounds/[organism id]

   * Stores default backgrounds
 
